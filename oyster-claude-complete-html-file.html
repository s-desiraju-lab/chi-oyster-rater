<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oyster Happy Hour Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;
        const { Star, Plus, Trash2, Users, MapPin, Clock, DollarSign, X } = lucide;

        function OysterHappyHourGridTracker() {
          const [restaurants, setRestaurants] = useState([]);
          const [groupMembers, setGroupMembers] = useState([]);
          const [newRestaurant, setNewRestaurant] = useState('');
          const [newMember, setNewMember] = useState('');
          const [showAddOysterForm, setShowAddOysterForm] = useState(null);
          const [newOyster, setNewOyster] = useState('');
          const [oysterOrigin, setOysterOrigin] = useState('');
          const [happyHourPrice, setHappyHourPrice] = useState('');
          const [regularPrice, setRegularPrice] = useState('');
          const [happyHourTime, setHappyHourTime] = useState('');

          const addRestaurant = () => {
            if (newRestaurant.trim()) {
              const restaurant = {
                id: Date.now(),
                name: newRestaurant.trim(),
                oysters: []
              };
              setRestaurants([...restaurants, restaurant]);
              setNewRestaurant('');
            }
          };

          const addGroupMember = () => {
            if (newMember.trim() && !groupMembers.includes(newMember.trim())) {
              setGroupMembers([...groupMembers, newMember.trim()]);
              setNewMember('');
            }
          };

          const removeGroupMember = (memberToRemove) => {
            setGroupMembers(groupMembers.filter(member => member !== memberToRemove));
            const updatedRestaurants = restaurants.map(restaurant => ({
              ...restaurant,
              oysters: restaurant.oysters.map(oyster => ({
                ...oyster,
                ratings: oyster.ratings.filter(rating => rating.member !== memberToRemove)
              }))
            }));
            setRestaurants(updatedRestaurants);
          };

          const addOyster = (restaurantId) => {
            if (!newOyster.trim()) return;

            const updatedRestaurants = restaurants.map(restaurant => {
              if (restaurant.id === restaurantId) {
                const oyster = {
                  id: Date.now(),
                  name: newOyster.trim(),
                  origin: oysterOrigin.trim(),
                  happyHourPrice: happyHourPrice.trim(),
                  regularPrice: regularPrice.trim(),
                  happyHourTime: happyHourTime.trim(),
                  ratings: []
                };
                return { ...restaurant, oysters: [...restaurant.oysters, oyster] };
              }
              return restaurant;
            });

            setRestaurants(updatedRestaurants);
            setNewOyster('');
            setOysterOrigin('');
            setHappyHourPrice('');
            setRegularPrice('');
            setHappyHourTime('');
            setShowAddOysterForm(null);
          };

          const updateRating = (restaurantId, oysterId, member, rating, notes = '') => {
            const updatedRestaurants = restaurants.map(restaurant => {
              if (restaurant.id === restaurantId) {
                const updatedOysters = restaurant.oysters.map(oyster => {
                  if (oyster.id === oysterId) {
                    const existingRatingIndex = oyster.ratings.findIndex(r => r.member === member);
                    let updatedRatings;
                    
                    if (existingRatingIndex >= 0) {
                      updatedRatings = [...oyster.ratings];
                      updatedRatings[existingRatingIndex] = { member, rating, notes, id: Date.now() };
                    } else {
                      updatedRatings = [...oyster.ratings, { member, rating, notes, id: Date.now() }];
                    }
                    
                    return { ...oyster, ratings: updatedRatings };
                  }
                  return oyster;
                });
                return { ...restaurant, oysters: updatedOysters };
              }
              return restaurant;
            });

            setRestaurants(updatedRestaurants);
          };

          const getRating = (oyster, member) => {
            const rating = oyster.ratings.find(r => r.member === member);
            return rating ? rating.rating : 0;
          };

          const getNotes = (oyster, member) => {
            const rating = oyster.ratings.find(r => r.member === member);
            return rating ? rating.notes : '';
          };

          const deleteRestaurant = (restaurantId) => {
            setRestaurants(restaurants.filter(r => r.id !== restaurantId));
          };

          const deleteOyster = (restaurantId, oysterId) => {
            const updatedRestaurants = restaurants.map(restaurant => {
              if (restaurant.id === restaurantId) {
                return {
                  ...restaurant,
                  oysters: restaurant.oysters.filter(oyster => oyster.id !== oysterId)
                };
              }
              return restaurant;
            });
            setRestaurants(updatedRestaurants);
          };

          const getAverageRating = (oyster) => {
            if (oyster.ratings.length === 0) return 0;
            return oyster.ratings.reduce((sum, r) => sum + r.rating, 0) / oyster.ratings.length;
          };

          const renderStars = (rating) => {
            return Array.from({ length: 5 }, (_, i) =>
              React.createElement(Star, {
                key: i,
                className: `w-4 h-4 ${
                  i < Math.floor(rating)
                    ? 'text-blue-400 fill-blue-400'
                    : i < rating
                    ? 'text-blue-400 fill-blue-200'
                    : 'text-gray-300'
                }`
              })
            );
          };

          const renderRatingInput = (currentRating, onChange) => {
            return Array.from({ length: 5 }, (_, i) =>
              React.createElement(Star, {
                key: i,
                className: `w-5 h-5 cursor-pointer transition-colors ${
                  i < currentRating
                    ? 'text-blue-400 fill-blue-400'
                    : 'text-gray-300 hover:text-blue-200'
                }`,
                onClick: () => onChange(i + 1)
              })
            );
          };

          const RatingCell = ({ oyster, member, restaurantId }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [tempRating, setTempRating] = useState(getRating(oyster, member));
            const [tempNotes, setTempNotes] = useState(getNotes(oyster, member));

            const handleSave = () => {
              if (tempRating > 0) {
                updateRating(restaurantId, oyster.id, member, tempRating, tempNotes);
              }
              setIsEditing(false);
            };

            const handleCancel = () => {
              setTempRating(getRating(oyster, member));
              setTempNotes(getNotes(oyster, member));
              setIsEditing(false);
            };

            if (isEditing) {
              return React.createElement('td', {
                className: 'p-2 border bg-blue-50'
              }, React.createElement('div', {
                className: 'space-y-2'
              }, [
                React.createElement('div', {
                  key: 'stars',
                  className: 'flex justify-center'
                }, renderRatingInput(tempRating, setTempRating)),
                React.createElement('textarea', {
                  key: 'notes',
                  value: tempNotes,
                  onChange: (e) => setTempNotes(e.target.value),
                  placeholder: 'Notes...',
                  className: 'w-full px-2 py-1 text-xs border rounded resize-none h-12'
                }),
                React.createElement('div', {
                  key: 'buttons',
                  className: 'flex gap-1'
                }, [
                  React.createElement('button', {
                    key: 'save',
                    onClick: handleSave,
                    className: 'flex-1 px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600'
                  }, 'Save'),
                  React.createElement('button', {
                    key: 'cancel',
                    onClick: handleCancel,
                    className: 'flex-1 px-2 py-1 bg-gray-500 text-white text-xs rounded hover:bg-gray-600'
                  }, 'Cancel')
                ])
              ]));
            }

            const currentRating = getRating(oyster, member);
            const currentNotes = getNotes(oyster, member);

            return React.createElement('td', {
              className: 'p-2 border bg-gray-50 hover:bg-blue-50 cursor-pointer text-center',
              onClick: () => setIsEditing(true)
            }, currentRating > 0 ? React.createElement('div', {}, [
              React.createElement('div', {
                key: 'stars',
                className: 'flex justify-center mb-1'
              }, renderStars(currentRating)),
              React.createElement('div', {
                key: 'rating',
                className: 'text-xs font-medium'
              }, `${currentRating}/5`),
              currentNotes && React.createElement('div', {
                key: 'notes',
                className: 'text-xs text-gray-600 mt-1 italic truncate',
                title: currentNotes
              }, `"${currentNotes}"`)
            ]) : React.createElement('div', {
              className: 'text-gray-400 text-sm'
            }, 'Click to rate'));
          };

          return React.createElement('div', {
            className: 'max-w-full mx-auto p-6 bg-gradient-to-br from-blue-50 to-cyan-50 min-h-screen'
          }, [
            React.createElement('div', {
              key: 'header',
              className: 'mb-8 text-center'
            }, [
              React.createElement('h1', {
                key: 'title',
                className: 'text-4xl font-bold text-gray-800 mb-2 flex items-center justify-center gap-3'
              }, [
                React.createElement('div', {
                  key: 'emoji',
                  className: 'text-4xl'
                }, 'ðŸ¦ª'),
                'Oyster Happy Hour Grid Tracker'
              ]),
              React.createElement('p', {
                key: 'subtitle',
                className: 'text-gray-600'
              }, 'Track oyster ratings across your group in a handy grid format!')
            ]),

            React.createElement('div', {
              key: 'setup',
              className: 'bg-white rounded-lg shadow-md p-6 mb-6'
            }, [
              React.createElement('div', {
                key: 'grid',
                className: 'grid md:grid-cols-2 gap-6'
              }, [
                React.createElement('div', {
                  key: 'restaurant'
                }, [
                  React.createElement('h2', {
                    key: 'title',
                    className: 'text-lg font-semibold mb-3 text-gray-800'
                  }, 'Add Restaurant'),
                  React.createElement('div', {
                    key: 'input',
                    className: 'flex gap-2'
                  }, [
                    React.createElement('input', {
                      key: 'field',
                      type: 'text',
                      placeholder: 'Restaurant name...',
                      value: newRestaurant,
                      onChange: (e) => setNewRestaurant(e.target.value),
                      className: 'flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                      onKeyPress: (e) => e.key === 'Enter' && addRestaurant()
                    }),
                    React.createElement('button', {
                      key: 'button',
                      onClick: addRestaurant,
                      className: 'px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors'
                    }, React.createElement(Plus, { className: 'w-4 h-4' }))
                  ])
                ]),
                React.createElement('div', {
                  key: 'member'
                }, [
                  React.createElement('h2', {
                    key: 'title',
                    className: 'text-lg font-semibold mb-3 text-gray-800'
                  }, 'Add Group Member'),
                  React.createElement('div', {
                    key: 'input',
                    className: 'flex gap-2'
                  }, [
                    React.createElement('input', {
                      key: 'field',
                      type: 'text',
                      placeholder: 'Member name...',
                      value: newMember,
                      onChange: (e) => setNewMember(e.target.value),
                      className: 'flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                      onKeyPress: (e) => e.key === 'Enter' && addGroupMember()
                    }),
                    React.createElement('button', {
                      key: 'button',
                      onClick: addGroupMember,
                      className: 'px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors'
                    }, React.createElement(Plus, { className: 'w-4 h-4' }))
                  ])
                ])
              ]),

              groupMembers.length > 0 && React.createElement('div', {
                key: 'members',
                className: 'mt-4'
              }, [
                React.createElement('h3', {
                  key: 'title',
                  className: 'text-sm font-medium text-gray-700 mb-2'
                }, 'Group Members:'),
                React.createElement('div', {
                  key: 'list',
                  className: 'flex flex-wrap gap-2'
                }, groupMembers.map(member =>
                  React.createElement('div', {
                    key: member,
                    className: 'bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm flex items-center gap-2'
                  }, [
                    member,
                    React.createElement('button', {
                      key: 'remove',
                      onClick: () => removeGroupMember(member),
                      className: 'hover:text-blue-600'
                    }, React.createElement(X, { className: 'w-3 h-3' }))
                  ])
                ))
              ])
            ]),

            restaurants.length > 0 && groupMembers.length > 0 ? React.createElement('div', {
              key: 'grid',
              className: 'bg-white rounded-lg shadow-md overflow-hidden'
            }, React.createElement('div', {
              className: 'overflow-x-auto'
            }, React.createElement('table', {
              className: 'w-full'
            }, [
              React.createElement('thead', {
                key: 'head'
              }, React.createElement('tr', {
                className: 'bg-blue-600 text-white'
              }, [
                React.createElement('th', {
                  key: 'restaurant',
                  className: 'p-4 text-left font-semibold'
                }, 'Restaurant / Oyster'),
                React.createElement('th', {
                  key: 'details',
                  className: 'p-4 text-center font-semibold'
                }, 'Details'),
                React.createElement('th', {
                  key: 'avg',
                  className: 'p-4 text-center font-semibold'
                }, 'Avg'),
                ...groupMembers.map(member =>
                  React.createElement('th', {
                    key: member,
                    className: 'p-4 text-center font-semibold min-w-32'
                  }, member)
                ),
                React.createElement('th', {
                  key: 'actions',
                  className: 'p-4 text-center font-semibold'
                }, 'Actions')
              ])),
              React.createElement('tbody', {
                key: 'body'
              }, restaurants.map(restaurant => [
                React.createElement('tr', {
                  key: restaurant.id,
                  className: 'bg-blue-100'
                }, [
                  React.createElement('td', {
                    key: 'name',
                    className: 'p-4 font-bold text-lg flex items-center gap-2'
                  }, [
                    React.createElement(MapPin, {
                      key: 'icon',
                      className: 'w-5 h-5 text-blue-600'
                    }),
                    restaurant.name
                  ]),
                  React.createElement('td', {
                    key: 'count',
                    className: 'p-4 text-center text-sm text-gray-600'
                  }, `${restaurant.oysters.length} varieties`),
                  React.createElement('td', { key: 'avg', className: 'p-4' }),
                  ...groupMembers.map(member =>
                    React.createElement('td', { key: member, className: 'p-4' })
                  ),
                  React.createElement('td', {
                    key: 'actions',
                    className: 'p-4 text-center'
                  }, React.createElement('div', {
                    className: 'flex gap-1 justify-center'
                  }, [
                    React.createElement('button', {
                      key: 'add',
                      onClick: () => setShowAddOysterForm(restaurant.id),
                      className: 'p-1 bg-green-500 text-white rounded hover:bg-green-600',
                      title: 'Add oyster'
                    }, React.createElement(Plus, { className: 'w-4 h-4' })),
                    React.createElement('button', {
                      key: 'delete',
                      onClick: () => deleteRestaurant(restaurant.id),
                      className: 'p-1 bg-red-500 text-white rounded hover:bg-red-600',
                      title: 'Delete restaurant'
                    }, React.createElement(Trash2, { className: 'w-4 h-4' }))
                  ]))
                ]),

                showAddOysterForm === restaurant.id && React.createElement('tr', {
                  key: `${restaurant.id}-form`,
                  className: 'bg-yellow-50'
                }, React.createElement('td', {
                  colSpan: groupMembers.length + 4,
                  className: 'p-4'
                }, React.createElement('div', {
                  className: 'grid grid-cols-6 gap-3'
                }, [
                  React.createElement('input', {
                    key: 'name',
                    type: 'text',
                    placeholder: 'Oyster name',
                    value: newOyster,
                    onChange: (e) => setNewOyster(e.target.value),
                    className: 'px-2 py-1 border rounded text-sm'
                  }),
                  React.createElement('input', {
                    key: 'origin',
                    type: 'text',
                    placeholder: 'Origin',
                    value: oysterOrigin,
                    onChange: (e) => setOysterOrigin(e.target.value),
                    className: 'px-2 py-1 border rounded text-sm'
                  }),
                  React.createElement('input', {
                    key: 'hh-price',
                    type: 'text',
                    placeholder: 'HH Price',
                    value: happyHourPrice,
                    onChange: (e) => setHappyHourPrice(e.target.value),
                    className: 'px-2 py-1 border rounded text-sm'
                  }),
                  React.createElement('input', {
                    key: 'reg-price',
                    type: 'text',
                    placeholder: 'Reg Price',
                    value: regularPrice,
                    onChange: (e) => setRegularPrice(e.target.value),
                    className: 'px-2 py-1 border rounded text-sm'
                  }),
                  React.createElement('input', {
                    key: 'hh-time',
                    type: 'text',
                    placeholder: 'HH Time',
                    value: happyHourTime,
                    onChange: (e) => setHappyHourTime(e.target.value),
                    className: 'px-2 py-1 border rounded text-sm'
                  }),
                  React.createElement('div', {
                    key: 'buttons',
                    className: 'flex gap-1'
                  }, [
                    React.createElement('button', {
                      key: 'add',
                      onClick: () => addOyster(restaurant.id),
                      className: 'px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600'
                    }, 'Add'),
                    React.createElement('button', {
                      key: 'cancel',
                      onClick: () => setShowAddOysterForm(null),
                      className: 'px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600'
                    }, 'Cancel')
                  ])
                ]))),

                ...restaurant.oysters.map(oyster =>
                  React.createElement('tr', {
                    key: oyster.id,
                    className: 'hover:bg-gray-50'
                  }, [
                    React.createElement('td', {
                      key: 'name',
                      className: 'p-4 pl-8 font-medium'
                    }, [
                      'ðŸ¦ª ', oyster.name,
                      oyster.origin && React.createElement('div', {
                        key: 'origin',
                        className: 'text-sm text-gray-600'
                      }, oyster.origin)
                    ]),
                    React.createElement('td', {
                      key: 'details',
                      className: 'p-4 text-center'
                    }, React.createElement('div', {
                      className: 'text-xs space-y-1'
                    }, [
                      oyster.happyHourPrice && React.createElement('div', {
                        key: 'hh-price',
                        className: 'bg-green-100 text-green-800 px-2 py-1 rounded'
                      }, `HH: ${oyster.happyHourPrice}`),
                      oyster.regularPrice && React.createElement('div', {
                        key: 'reg-price',
                        className: 'text-gray-600'
                      }, `Reg: ${oyster.regularPrice}`),
                      oyster.happyHourTime && React.createElement('div', {
                        key: 'hh-time',
                        className: 'text-blue-600 flex items-center justify-center gap-1'
                      }, [
                        React.createElement(Clock, {
                          key: 'icon',
                          className: 'w-3 h-3'
                        }),
                        oyster.happyHourTime
                      ])
                    ])),
                    React.createElement('td', {
                      key: 'avg',
                      className: 'p-4 text-center'
                    }, [
                      React.createElement('div', {
                        key: 'stars',
                        className: 'flex justify-center mb-1'
                      }, renderStars(getAverageRating(oyster))),
                      React.createElement('div', {
                        key: 'rating',
                        className: 'text-xs text-gray-600'
                      }, getAverageRating(oyster).toFixed(1))
                    ]),
                    ...groupMembers.map(member =>
                      React.createElement(RatingCell, {
                        key: member,
                        oyster: oyster,
                        member: member,
                        restaurantId: restaurant.id
                      })
                    ),
                    React.createElement('td', {
                      key: 'actions',
                      className: 'p-4 text-center'
                    }, React.createElement('button', {
                      onClick: () => deleteOyster(restaurant.id, oyster.id),
                      className: 'p-1 bg-red-500 text-white rounded hover:bg-red-600',
                      title: 'Delete oyster'
                    }, React.createElement(Trash2, { className: 'w-4 h-4' })))
                  ])
                )
              ]))
            ]))) : React.createElement('div', {
              key: 'empty',
              className: 'bg-white rounded-lg shadow-md p-12 text-center'
            }, [
              React.createElement('div', {
                key: 'emoji',
                className: 'text-6xl mb-4'
              }, 'ðŸ¦ª'),
              React.createElement('h3', {
                key: 'title',
                className: 'text-lg font-semibold text-gray-600 mb-2'
              }, 'Get Started'),
              React.createElement('p', {
                key: 'subtitle',
                className: 'text-gray-500'
              }, 'Add some restaurants and group members above to start tracking oyster ratings in the grid!')
            ])
          ]);
        }

        // Load Lucide icons
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/lucide@latest/dist/umd/lucide.js';
        script.onload = function() {
          ReactDOM.render(React.createElement(OysterHappyHourGridTracker), document.getElementById('root'));
        };
        document.head.appendChild(script);
    </script>
</body>
</html>